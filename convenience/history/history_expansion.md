# 命令历史扩展

**历史命令扩展**是一种让你快速调用历史命令的方式。

一个历史命令扩展由 `!`开始。它可能出现在命令的任何地方，但是不会嵌套。如果你要在命令行中使用“！”符号，请使用引号。

在你输入 `ENTER` 以后， `zsh` 会评估之前所有的命令历史。然后打印出目前位置的命令行，然后继续进行其他类型的替换和扩展。

（有些人希望 `shell` 在处理命令的其余部分之前仔细检查这些历史扩展。具体的选项请参阅“[相关选项](https://www-s.acm.illinois.edu/workshops/zsh/related/hist_expn.html)"上的 `HIST_VERIFY`)

### 一些方便的技巧

- 你可以使用上下方向键循环查看历史命令。这仅仅适用于你的终端按键绑定到合适的编辑命令时。（查看 `zsh` 编辑器获取详细信息）
- 通过在命令行中输入**`^ old ^ new`**，您可以运行先前的任何旧命令替换为新命令。
- 您可以将事件放入历史列表中，而**无需**实际执行该命令。 你可以用`print`内建命令的`-s`参数来做到这一点。 

### 语法

历史命令扩展有三部分：**事件指示符**，**单词指示符**（可选），**单词修饰符**（可选）。语法如下：

[语法和用法注释](https://www-s.acm.illinois.edu/workshops/zsh/syntax_notes/hist_expn.html#1)

>designator [:word] \[:mod1:mod2...]

- 事件指示符

事件指示符只是您在命令行上键入的内容，它引用历史记录列表中的条目。 有许多有用的事件指示符，总结如下：
| 指示符     | 功能                                                       |
| ---------- | ---------------------------------------------------------- |
| `!`        | 开始一个历史命令扩展，除非后面跟空格，换行符，`=` 或者 `(` |
| `!!`       | 指前面的命令，这个扩展重复了前面的命令。                   |
| `!n`       | 指命令行`n`                                                |
| `!-n`      | 指当前命令减n                                              |
| `!str`     | 指最近的以`str` 开头的命令                                 |
| `!?str[?]` | 指最近的包含`str`的命令                                    |
| `!#`       | 指截至目前为止的命令                                       |
| `!{...}`   | 隔离相邻字符的历史（如有必要）                             |

- 单词指示符

当参考历史命令时，你不需要恢复整个命令。可能你只需要历史命令的一部分，你可以使用**单词指示符**来指定哪个或者哪些单词你想要使用。简单从上面指定一个事件指示符，然后指定单词指示符。

下面是可用的单词指示符：
| 指示符 | 功能                         |
| ------ | ---------------------------- |
| `0`    | 第一个输入的单词             |
| `n`    | 第n个参数                    |
| `^`    | 第一个参数                   |
| `$`    | 最后一个参数                 |
| `%`    | 匹配`str` 的单词             |
| `x-y`  | 一个范围的单词。`x`默认为`0` |
| `*`    | 所有的参数                   |
| `x*`   | `x-$`的缩写                  |
| `x-`   | 像`x*`一样，但是忽略`$`      |

### 单词修饰符

这是和文件名生成器和参数扩展一样的修饰符。查看[修饰符](https://www-s.acm.illinois.edu/workshops/zsh/modifiers.html)。